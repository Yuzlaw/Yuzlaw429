# YuzXing 系統深度檢查報告

## 一、試算表欄位分析

### ETF投資追蹤工作表（第5行為欄位標題）
1. ETF代號
2. 中文名稱
3. 投入金額
4. 收盤價
5. 持股數量
6. 當前市值
7. 未實現損益
8. 報酬率(%)
9. 殖利率(%)
10. 年預估配息

### 每日記帳工作表（第4行為欄位標題）
1. 日期
2. 類型
3. 類別
4. 金額
5. 備註

## 二、發現的問題

### 問題 1：PWA ETF 欄位不完整
**現狀**：PWA 的 ETF 對話框只有基本欄位
**應有欄位**：
- ETF代號 ✅
- 中文名稱 ✅
- 投入金額 ✅
- 持股數量 ✅
- 收盤價 ❌（應自動從 Yahoo Finance API 取得）
- 當前市值 ❌（應自動計算：持股數量 × 收盤價）
- 未實現損益 ❌（應自動計算：當前市值 - 投入金額）
- 報酬率(%) ❌（應自動計算：未實現損益 / 投入金額 × 100）
- 殖利率(%) ❌（需要手動輸入或從 API 取得）
- 年預估配息 ❌（需要手動輸入或從 API 取得）

**修正方案**：
1. 對話框加入「殖利率」和「年預估配息」欄位
2. 顯示時自動取得即時股價
3. 自動計算市值、損益、報酬率

### 問題 2：記帳欄位對應
**現狀**：PWA 記帳對話框欄位
- 類型（收入/支出）✅
- 類別 ✅
- 金額 ✅
- 備註 ✅
- 日期 ❌（缺少）

**修正方案**：加入日期選擇器

### 問題 3：側邊欄重複「控制台」
**現狀**：側邊欄有兩個「控制台」按鈕
**修正方案**：移除重複，改名為「設定」

### 問題 4：Google Apps Script API 欄位對應
**需要檢查**：
- API 是否支援所有試算表欄位
- 是否正確處理計算欄位（不應該寫入，應該讓試算表公式自動計算）

### 問題 5：缺少筆記、學習、法律的試算表工作表
**現狀**：用戶提供的試算表只有「ETF投資追蹤」和「每日記帳」
**需要**：
- 筆記資料庫工作表
- 學習紀錄工作表
- 法律資料庫工作表

### 問題 6：ETF 投資組合總覽
**缺少**：
- 總投入金額
- 總當前市值
- 總未實現損益
- 總報酬率

### 問題 7：月份記帳工作表對應
**現狀**：試算表有 1-12月 獨立工作表
**PWA**：有月份選擇器
**需確認**：API 是否正確寫入對應月份的工作表

## 三、優先修正清單

### 高優先級
1. ✅ 移除側邊欄重複的「控制台」
2. ✅ ETF 頁面加入即時股價顯示
3. ✅ ETF 頁面加入自動計算欄位（市值、損益、報酬率）
4. ✅ 記帳對話框加入日期選擇器
5. ✅ ETF 對話框加入殖利率和年預估配息欄位

### 中優先級
6. ✅ 建立完整的試算表範本（包含筆記、學習、法律工作表）
7. ✅ 檢查並修正 Google Apps Script API
8. ✅ 加入 ETF 投資組合總覽統計

### 低優先級
9. ⏸ UI 一致性優化
10. ⏸ 錯誤處理優化
