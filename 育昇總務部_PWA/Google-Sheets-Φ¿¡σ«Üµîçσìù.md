# Google Sheets 試算表設定指南

## 一、建立試算表

### 1. 開啟您提供的試算表
- 檔案：`Google試算表_雙軌記帳系統.xlsx`
- 或建立新的 Google Sheets

### 2. 確認工作表結構

您的試算表應包含以下工作表：

#### 工作表 1：筆記資料庫
| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| ID | 自動編號 | 1, 2, 3... |
| 建立時間 | 自動記錄 | 2025-01-15 10:30:00 |
| 更新時間 | 自動記錄 | 2025-01-15 14:20:00 |
| 標題 | 筆記標題 | "會議記錄" |
| 內容 | 筆記完整內容 | "今天討論了..." |
| 分類 | 筆記分類 | "工作", "個人", "學習" |
| 標籤 | 多個標籤（逗號分隔） | "重要,待辦,專案A" |
| 是否釘選 | TRUE/FALSE | TRUE |
| 是否封存 | TRUE/FALSE | FALSE |
| 圖片URL | 圖片連結（逗號分隔） | "https://..." |

#### 工作表 2：ETF投資追蹤
| 欄位名稱 | 說明 | 範例 | 公式 |
|---------|------|------|------|
| ETF代號 | 代號 | 0056.TW | 手動輸入 |
| 中文名稱 | 名稱 | 元大高股息 | 手動輸入 |
| 投入金額 | 總投入 (TWD) | 950000 | 手動輸入 |
| 收盤價 | 即時價格 | 36.41 | `=GOOGLEFINANCE("TPE:0056", "price")` |
| 持股數量 | 持幣數量 | 24675 | 手動輸入 |
| 當前市值 | 市值 | 898000 | `=E2*D2` |
| 未實現損益 | 損益 | -52000 | `=F2-C2` |
| 報酬率(%) | 報酬率 | -5.47% | `=IF(C2>0,(G2/C2)*100,0)` |
| 殖利率(%) | 殖利率 | 7.2 | 手動輸入 |
| 年預估配息 | 配息 | 2.77 | 手動輸入 |
| 配息頻率 | 頻率 | 季配 | 手動輸入 |
| 建議動作 | 建議 | 觀察 | 手動輸入 |

#### 工作表 3：每日記帳
| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| ID | 自動編號 | 1, 2, 3... |
| 日期 | 記帳日期 | 2025-01-15 |
| 類型 | 收入/支出 | 收入, 支出 |
| 類別 | 分類 | 飲食, 交通, 薪資 |
| 金額 | 金額 | 150 |
| 備註 | 備註 | 午餐 |

#### 工作表 4：學習紀錄
| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| ID | 自動編號 | 1, 2, 3... |
| 建立時間 | 自動記錄 | 2025-01-15 10:30:00 |
| 更新時間 | 自動記錄 | 2025-01-15 14:20:00 |
| 標題 | 學習主題 | "Python 進階教學" |
| 內容 | 學習筆記 | "今天學習了..." |
| 來源 | 學習來源 | "Udemy", "YouTube" |
| 連結 | 相關連結 | "https://..." |
| 進度 | 學習進度 (%) | 75 |
| 狀態 | 學習狀態 | "進行中", "已完成", "暫停" |
| 分類 | 學習分類 | "程式設計", "語言" |
| 標籤 | 多個標籤 | "Python,進階,實作" |

#### 工作表 5：法律資料庫
| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| ID | 自動編號 | 1, 2, 3... |
| 建立時間 | 自動記錄 | 2025-01-15 10:30:00 |
| 更新時間 | 自動記錄 | 2025-01-15 14:20:00 |
| 標題 | 法律事項標題 | "租賃契約" |
| 內容 | 詳細內容 | "契約內容..." |
| 類型 | 法律類型 | "契約", "法規", "判例", "諮詢" |
| 狀態 | 處理狀態 | "待處理", "進行中", "已完成" |
| 重要性 | 重要程度 | "高", "中", "低" |
| 到期日 | 重要日期 | 2025-12-31 |
| 相關文件 | 文件連結 | "https://..." |
| 標籤 | 多個標籤 | "租屋,契約,重要" |

---

## 二、設定 Google Apps Script

### 1. 開啟指令碼編輯器
1. 在 Google Sheets 中，點擊「擴充功能」>「Apps Script」
2. 刪除預設的程式碼

### 2. 貼上 API 程式碼
1. 複製 `Google-Apps-Script-API.gs` 的內容
2. 貼到指令碼編輯器
3. 修改第 14 行的 `SPREADSHEET_ID`：
   ```javascript
   const SPREADSHEET_ID = '你的試算表ID';
   ```
   
   **如何取得試算表 ID？**
   - 開啟 Google Sheets
   - 網址列會顯示：`https://docs.google.com/spreadsheets/d/【這裡就是ID】/edit`
   - 複製【】中的內容

### 3. 儲存並部署
1. 點擊「儲存」圖示
2. 點擊「部署」>「新增部署作業」
3. 類型：選擇「網頁應用程式」
4. 說明：輸入「YuzXing API v1」
5. 執行身分：選擇「我」
6. 存取權：選擇「任何人」
7. 點擊「部署」
8. **複製「網頁應用程式 URL」**（這個很重要！）

### 4. 授權
1. 第一次部署會要求授權
2. 點擊「授權存取權」
3. 選擇您的 Google 帳號
4. 點擊「進階」>「前往 YuzXing API（不安全）」
5. 點擊「允許」

---

## 三、設定定時觸發器（自動更新 ETF）

### 1. 建立觸發器
1. 在 Apps Script 編輯器中，點擊左側「觸發條件」（時鐘圖示）
2. 點擊右下角「新增觸發條件」

### 2. 每日更新設定
- 選擇要執行的函式：`dailyUpdateETF`
- 選擇活動來源：`時間驅動`
- 選擇時間型觸發條件類型：`日計時器`
- 選擇時段：`上午 9 時至 10 時`
- 點擊「儲存」

### 3. 每小時更新設定（選用）
- 選擇要執行的函式：`hourlyUpdateETF`
- 選擇活動來源：`時間驅動`
- 選擇時間型觸發條件類型：`小時計時器`
- 選擇時段：`每小時`
- 點擊「儲存」

---

## 四、測試 API

### 1. 測試 GET 請求
在瀏覽器中開啟：
```
你的網頁應用程式URL?action=getAll&sheet=筆記資料庫
```

應該會看到 JSON 回應：
```json
{
  "statusCode": 200,
  "data": [...]
}
```

### 2. 測試 POST 請求
使用 Postman 或 curl：
```bash
curl -X POST "你的網頁應用程式URL" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "create",
    "sheet": "筆記資料庫",
    "record": {
      "標題": "測試筆記",
      "內容": "這是測試內容",
      "分類": "測試",
      "標籤": "測試",
      "是否釘選": false,
      "是否封存": false
    }
  }'
```

---

## 五、將 URL 設定到系統

1. 複製您的「網頁應用程式 URL」
2. 開啟 YuzXing 系統
3. 進入「控制台」
4. 在「Google Apps Script URL」欄位貼上 URL
5. 點擊「儲存」
6. 點擊「測試連線」確認連線成功

---

## 六、常見問題

### Q1: 為什麼 GOOGLEFINANCE 函數沒有更新？
**A:** 
- 確認 ETF 代號格式正確（如 `TPE:0056`）
- Google Finance 可能有延遲，等待幾分鐘
- 手動重新整理試算表

### Q2: API 回傳 404 錯誤？
**A:**
- 確認工作表名稱完全一致（包含空格）
- 確認 SPREADSHEET_ID 正確

### Q3: 無法授權 Apps Script？
**A:**
- 確認您是試算表的擁有者
- 嘗試使用無痕模式重新授權

### Q4: 觸發器沒有執行？
**A:**
- 檢查「我的觸發條件」頁面的執行記錄
- 確認觸發器已啟用
- 檢查是否有錯誤訊息

---

## 七、安全性建議

1. **不要公開分享試算表**：設定為「僅限特定人員」
2. **定期備份**：定期匯出試算表備份
3. **使用強密碼**：保護您的 Google 帳號
4. **監控 API 使用**：定期檢查 Apps Script 的執行記錄

---

## 八、進階設定

### 自訂 ETF 代號對應
如果您的 ETF 代號與 Google Finance 不同，可以在 Apps Script 中加入對應表：

```javascript
const ETF_MAPPING = {
  '0056': 'TPE:0056',
  '00878': 'TPE:00878',
  // ... 更多對應
};
```

### 自訂計算公式
您可以在試算表中自訂任何計算公式，系統會自動讀取計算結果。

---

## 九、完成！

設定完成後，您的 YuzXing 系統就可以：
- ✅ 自動更新 ETF 價格
- ✅ 新增/修改/刪除所有資料
- ✅ 所有資料儲存在 Google Sheets
- ✅ 離線時也能查看資料（快取）
- ✅ 多裝置同步

如有任何問題，請參考「常見問題」或聯絡技術支援。
